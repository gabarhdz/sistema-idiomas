<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crear ejercicio - Luodingo</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body
    class="bg-gradient-to-br from-pink-500 via-fuchsia-500 to-purple-600 min-h-screen flex items-center justify-center">
    <div class="bg-white bg-opacity-90 rounded-3xl shadow-2xl p-8 max-w-lg w-full">
        <h1 class="text-3xl font-bold text-fuchsia-700 mb-2 text-center">Crear ejercicio</h1>
        <h2 class="text-lg text-pink-600 mb-6 text-center">Añade las respuestas del ejercicio</h2>
        <form id="exercise-form" class="flex flex-col gap-4">
            <input type="text" name="title" placeholder="Título"
                class="px-4 py-3 rounded-lg border border-fuchsia-300 focus:outline-none focus:ring-2 focus:ring-fuchsia-500"
                required>
            <textarea name="instruction" placeholder="Instrucción" rows="3"
                class="px-4 py-3 rounded-lg border border-fuchsia-300 focus:outline-none focus:ring-2 focus:ring-fuchsia-500"
                required></textarea>
            <div>
                <label class="block text-fuchsia-700 font-semibold mb-2">Opciones</label>
                <div id="options-container" class="flex flex-col gap-2">
                    <input type="text" name="option" placeholder="Opción 1"
                        class="px-4 py-2 rounded-lg border border-fuchsia-300 focus:outline-none focus:ring-2 focus:ring-fuchsia-500"
                        required>
                    <input type="text" name="option" placeholder="Opción 2"
                        class="px-4 py-2 rounded-lg border border-fuchsia-300 focus:outline-none focus:ring-2 focus:ring-fuchsia-500"
                        required>
                </div>
                <button type="button" id="add-option"
                    class="mt-2 bg-pink-500 hover:bg-pink-600 text-white font-bold py-2 px-4 rounded-lg transition duration-200">
                    Añadir opción
                </button>
            </div>
            <input type="number" name="answer" min="0" placeholder="Índice de la respuesta correcta (ej: 0)"
                class="px-4 py-3 rounded-lg border border-fuchsia-300 focus:outline-none focus:ring-2 focus:ring-fuchsia-500"
                required>
            <button type="submit"
                class="bg-fuchsia-600 hover:bg-fuchsia-700 text-white font-bold py-3 rounded-lg transition duration-200 mt-2">
                Crear ejercicio
            </button>
        </form>
        <div id="msg" class="mt-4 text-center text-sm"></div>
    </div>
    <script>
        // Añadir más opciones dinámicamente
        document.getElementById('add-option').addEventListener('click', function () {
            const container = document.getElementById('options-container');
            const input = document.createElement('input');
            input.type = 'text';
            input.name = 'option';
            input.placeholder = `Opción ${container.children.length + 1}`;
            input.className = "px-4 py-2 rounded-lg border border-fuchsia-300 focus:outline-none focus:ring-2 focus:ring-fuchsia-500";
            input.required = true;
            container.appendChild(input);
        });

        // Enviar el formulario
        document.getElementById('exercise-form').addEventListener('submit', function (event) {
            event.preventDefault();
            const title = this.title.value.trim();
            const instruction = this.instruction.value.trim();
            const user = localStorage.getItem("token");
            const options = Array.from(document.querySelectorAll('input[name="option"]')).map(opt => opt.value.trim()).filter(opt => opt);
            const answer = parseInt(this.answer.value, 10);
            console.log("ay dios mio")
            if (!title || !instruction || !user || options.length < 2 || isNaN(answer) || answer < 0 || answer >= options.length) {
                document.getElementById('msg').textContent = 'Por favor, completa todos los campos correctamente.';
                document.getElementById('msg').className = 'mt-4 text-center text-sm text-pink-600';
                return;
            }

            fetch('/api/exercises', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${user}`
                },
                body: JSON.stringify({ title, instruction, options, answer })
            })
                .then(res => res.json())
                .then(data => {
                    document.getElementById('msg').textContent = 'Ejercicio creado exitosamente.';
                    document.getElementById('msg').className = 'mt-4 text-center text-sm text-fuchsia-700';
                    document.getElementById('exercise-form').reset();
                    document.getElementById('options-container').innerHTML = `
                    <input type="text" name="option" placeholder="Opción 1" class="px-4 py-2 rounded-lg border border-fuchsia-300 focus:outline-none focus:ring-2 focus:ring-fuchsia-500" required>
                    <input type="text" name="option" placeholder="Opción 2" class="px-4 py-2 rounded-lg border border-fuchsia-300 focus:outline-none focus:ring-2 focus:ring-fuchsia-500" required>
                `;
                })
                .catch(() => {
                    document.getElementById('msg').textContent = 'Error al crear el ejercicio.';
                    document.getElementById('msg').className = 'mt-4 text-center text-sm text-pink-600';
                });
        });
    </script>
</body>

</html>